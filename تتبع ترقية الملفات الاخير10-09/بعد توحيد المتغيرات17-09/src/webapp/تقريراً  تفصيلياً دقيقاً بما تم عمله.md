
# ุชูุฑูุฑ ุชูุตููู ูุชูููุฐ ุฎุทูุงุช ุชูุญูุฏ ุงูุฏูุงู ุงูุญุณุงุจูุฉ

## ููุฏูุฉ
ุชู ุชูููุฐ ุฎุทูุงุช ุชูุญูุฏ ุงูุฏูุงู ุงูุญุณุงุจูุฉ ุจูุงุกู ุนูู ุงูุฎุทุฉ ุงูููุถุญุฉ ูู ููู `4IMPLEMENTATION_STEPS- ุฎุทูุงุช ุงูุชุทุจูู ุงูุนููู.md`. ุงููุฏู ูุงู ุชูุญูุฏ ุฌููุน ุงูุฏูุงู ุงูุญุณุงุจูุฉ ุงููุชูุฑุฑุฉ ูุงููุชุนุงุฑุถุฉ ูู ููู ูุงุญุฏ (`calculations.ts`) ูุชุญุฏูุซ ุงููููุงุช ุงููุณุชุฎุฏูุฉ ููุฐู ุงูุฏูุงู ูุงุณุชุฎุฏุงู ุงููุณุฎ ุงูููุญุฏุฉ.

## ูุง ุชู ุฅูุฌุงุฒู

### 1. ุงูุชุญูู ูู ููู ุงูุญุณุงุจุงุช ุงูููุญุฏ
- **ุชู ุงูุชุญูู ูู ูุฌูุฏ ููู `calculations.ts`** (ูููุณ `calculation.ts` ููุง ูู ูุฐููุฑ ูู ุงูุฎุทุฉ)
- **ุชู ุงูุชุฃูุฏ ูู ุฃู ุงูููู ูุญุชูู ุนูู ุฌููุน ุงูุฏูุงู ุงููุทููุจุฉ**:
  - `calculateOfferTotal` ูุญุณุงุจ ุฅุฌูุงูู ูุจูุบ ุงูุนุฑุถ
  - `calculateOfferTotalAfterTax` ูุญุณุงุจ ุงูุฅุฌูุงูู ุจุนุฏ ุงูุถุฑุงุฆุจ
  - `calculateTotalInYR` ููุชุญููู ุฅูู ุงูุฑูุงู ุงููููู
  - `calculateAwardedAmount` ูุญุณุงุจ ุงููุจุงูุบ ุงููุฑุณู ุนูููุง
  - `calculateTotalAwardedAmount` ูุญุณุงุจ ุฅุฌูุงูู ุงููุจุงูุบ ุงููุฑุณู ุนูููุง
  - `calculatePriceDifference` ูุญุณุงุจ ูุฑูู ุงูุฃุณุนุงุฑ
  - `updateOfferCalculations` ูุชุญุฏูุซ ุญุณุงุจุงุช ุงูุนุฑูุถ
  - `updateRecommendedOfferCalculations` ูุชุญุฏูุซ ุญุณุงุจุงุช ุงูุนุฑูุถ ุงูููุตู ุจูุง
  - `checkAmountMismatch` ููุชุญูู ูู ุชุทุงุจู ุงููุจุงูุบ
  - ูุบูุฑูุง ูู ุงูุฏูุงู ุงููุณุงุนุฏุฉ

### 2. ุชุญุฏูุซ ููู PriceOffersSection.tsx
- **ุชูุช ุฅุถุงูุฉ ุงูุงุณุชูุฑุงุฏุงุช ุงููุทููุจุฉ** ูู ููู calculations.ts:
  ```typescript
  import { 
    updateOfferCalculations, 
    checkAmountMismatch,
    calculateOfferTotal,
    calculateOfferTotalAfterTax 
  } from '../utils/calculations';
  ```

- **ุชู ุชุญุฏูุซ ุฏุงูุฉ handleUpdateOffer** ูุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูููุญุฏุฉ `updateOfferCalculations`:
  ```typescript
  const handleUpdateOffer = (index: number, updates: Partial<PriceOffer>) => {
    setPriceOffers(priceOffers.map((offer, i) => {
      if (i === index) {
        const updatedOffer = { ...offer, ...updates };
        // ๐ ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูููุญุฏุฉ ุจุฏูุงู ูู ุงูุญุณุงุจุงุช ุงููุนูุฏุฉ
        return updateOfferCalculations(updatedOffer, updatedOffer.taxIncluded);
      }
      return offer;
    }));
  };
  ```

- **ุชู ุชุญุฏูุซ ุฏุงูุฉ checkAmountConsistency** ูุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูููุญุฏุฉ `checkAmountMismatch`:
  ```typescript
  const checkAmountConsistency = (index: number): boolean => {
    const offer = priceOffers[index];
    if (!offer) return true;
    
    // ๐ ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูููุญุฏุฉ
    const mismatchCheck = checkAmountMismatch(offer);
    return mismatchCheck.isMatched;
  };
  ```

### 3. ุชุญุฏูุซ ููู RecommendationSection.tsx
- **ุชูุช ุฅุถุงูุฉ ุงูุงุณุชูุฑุงุฏุงุช ุงููุทููุจุฉ** ูู ููู calculations.ts:
  ```typescript
  import { 
    calculateAwardedAmount,
    calculateTotalAwardedAmount,
    updateRecommendedOfferCalculations 
  } from '../utils/calculations';
  ```

- **ุชู ุชุญุฏูุซ ุฏุงูุฉ toggleVendorSelection** ูุงุณุชุฎุฏุงู ุงูุฏูุงู ุงูููุญุฏุฉ:
  - ุงุณุชุฎุฏุงู `calculateAwardedAmount` ูุญุณุงุจ ุงููุจูุบ ุงููุฑุณู ุนููู:
    ```typescript
    const awardedAmount = calculateAwardedAmount(
      selectedOffer.lineItems || [], 
      selectedOffer.taxIncluded
    );
    ```
  
  - ุงุณุชุฎุฏุงู `updateRecommendedOfferCalculations` ูุชุญุฏูุซ ุงูุญุณุงุจุงุช:
    ```typescript
    const updatedOffer = updateRecommendedOfferCalculations(newOffer, selectedOffer);
    ```
  
  - ุงุณุชุฎุฏุงู `calculateTotalAwardedAmount` ูุญุณุงุจ ุงูุฅุฌูุงููุงุช:
    ```typescript
    const totals = calculateTotalAwardedAmount(newSelectedOffers);
    ```

- **ุชู ุงุณุชุจุฏุงู ุงุณุชุฎุฏุงู newOffer ุจู updatedOffer** ูู ุฌููุน ุฃุฌุฒุงุก ุงูุฏุงูุฉ ูุถูุงู ุงุณุชุฎุฏุงู ุงูููู ุงููุญุณูุจุฉ ุจุดูู ุตุญูุญ.

### 4. ุชุญุฏูุซ ููู ComparisonPage.tsx
- **ุชูุช ุฅุถุงูุฉ ุงุณุชูุฑุงุฏ calculatePriceDifference** ูู ููู calculations.ts:
  ```typescript
  import { calculatePriceDifference } from '../utils/calculations';
  ```

- **ุชู ุชุญุฏูุซ ููุทู ุญุณุงุจ ุงููุฑูู** ูู ุฏุงูุฉ getSpecificationDifferences:
  - ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูููุญุฏุฉ `calculatePriceDifference`:
    ```typescript
    const priceDiff = calculatePriceDifference(
      unitPriceAfterTax,        // ุณุนุฑ ุงููุญุฏุฉ ุงูููุฏู
      estimatedCostInfo.amount, // ุงูุชูููุฉ ุงูุชูุฏูุฑูุฉ ูููุญุฏุฉ
      offer.currency,
      offer.exchangeRate || 1
    );
    ```
  
  - ุญุณุงุจ ุงููุฑู ุนูู ูุณุชูู ุณุนุฑ ุงููุญุฏุฉ ุจุฏูุงู ูู ุงูุฅุฌูุงูู:
    ```typescript
    // โ ุงูุทุฑููุฉ ุงููุฏููุฉ (ุฎุทุฃ)
    const offeredTotal = unitPriceInRiyal * (lineItem?.offeredQty || item.quantity);
    const estimatedTotal = estimatedCost * item.quantity;
    const percentageDiff = ((offeredTotal - estimatedTotal) / estimatedTotal) * 100;
    
    // โ ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ (ุตุญูุญุฉ)
    const priceDiff = calculatePriceDifference(
      unitPriceAfterTax,        // ุณุนุฑ ุงููุญุฏุฉ ุงูููุฏู
      estimatedCostInfo.amount, // ุงูุชูููุฉ ุงูุชูุฏูุฑูุฉ ูููุญุฏุฉ (ุจุฏูู ุถุฑุจ ุจุงููููุฉ)
      offer.currency,
      exchangeRate
    );
    ```
  
  - ุชุญุณูู ุนุฑุถ ุงููุชุงุฆุฌ ูุน ูุตูุต ุฃูุถุญ:
    ```typescript
    if (Math.abs(priceDiff.percentage) < 0.01) {
      priceStatus = 'ูุทุงุจู ููุชูููุฉ ุงูุชูุฏูุฑูุฉ';
    } else if (priceDiff.isHigher) {
      priceStatus = `ุฃุนูู ูู ุงูุชูููุฉ ุจู ${priceDiff.percentage.toFixed(2)}%`;
    } else {
      priceStatus = `ุฃูู ูู ุงูุชูููุฉ ุจู ${Math.abs(priceDiff.percentage).toFixed(2)}%`;
    }
    
    differences += `<p><strong>ููุงุฑูุฉ ุงูุณุนุฑ:</strong> ${priceStatus}</p>`;
    ```

## ุงูููุงุญุธุงุช ูุงููุดุงูู ุงูุชู ุชู ููุงุฌูุชูุง

### 1. ุงุณู ุงูููู
- **ุงูููุงุญุธุฉ**: ุงูููู ุงูููุญุฏ ุงุณูู `calculations.ts` ูููุณ `calculation.ts` ููุง ูู ูุฐููุฑ ูู ุงูุฎุทุฉ.
- **ุงูุชุฃุซูุฑ**: ุชู ุชุนุฏูู ุฌููุน ุงูุงุณุชูุฑุงุฏุงุช ูุงุณุชุฎุฏุงู ุงูุงุณู ุงูุตุญูุญ.

### 2. ุตุนูุจุฉ ูู ูุทุงุจูุฉ ุงููุตูุต
- **ุงูููุงุญุธุฉ**: ูุงุฌูุช ุตุนูุจุฉ ูู ูุทุงุจูุฉ ุงููุตูุต ุจุฏูุฉ ุนูุฏ ุชุนุฏูู ุงููููุงุชุ ุฎุงุตุฉ ูู ููู RecommendationSection.tsx.
- **ุงูุญู**: ุชู ุชุนุฏูู ุงูุฃุฌุฒุงุก ุงูุตุบูุฑุฉ ูู ุงูุฏูุงู ุจุฏูุงู ูู ุชุนุฏูู ุงูุฏุงูุฉ ุจุงููุงูู ุฏูุนุฉ ูุงุญุฏุฉ.

### 3. ุงูุญูุงุธ ุนูู ุงูุชูุงูู
- **ุงูููุงุญุธุฉ**: ูู ุจุนุถ ุงูุญุงูุงุชุ ูุงู ูู ุงูุถุฑูุฑู ุงูุญูุงุธ ุนูู ุจุนุถ ุงููุชุบูุฑุงุช ุงููุฏููุฉ ูุถูุงู ุงูุชูุงูู ูุน ุจููุฉ ุงูููุฏ.
- **ุงูุญู**: ุชู ุงูุงุญุชูุงุธ ุจุจุนุถ ุงููุชุบูุฑุงุช ุงููุฏููุฉ ูุน ุฅุถุงูุฉ ุชุนูููุงุช ุชูุถูุญูุฉ.

## ุงููุชุงุฆุฌ ุงููุญููุฉ

### 1. ุชูุญูุฏ ุงูุญุณุงุจุงุช
- ุฌููุน ุงูุญุณุงุจุงุช ุชุชู ุงูุขู ุจุงุณุชุฎุฏุงู ุงูุฏูุงู ุงูููุญุฏุฉ ูู ููู calculations.ts.
- ุชู ุงููุถุงุก ุนูู ุชูุฑุงุฑ ุงูุฏูุงู ุงูุญุณุงุจูุฉ ูู ูููุงุช ูุชุนุฏุฏุฉ.

### 2. ุฏูุฉ ุฃูุจุฑ
- ุชู ุฅุตูุงุญ ุฎุทุฃ ุญุณุงุจ ุงููุฑูู ุงูุฐู ูุงู ูุชู ุนูู ุงูุฅุฌูุงูู ุจุฏูุงู ูู ุณุนุฑ ุงููุญุฏุฉ.
- ุชู ุชุญุณูู ุฏูุฉ ุงูุญุณุงุจุงุช ุจุดูู ุนุงู.

### 3. ุณูููุฉ ุงูุตูุงูุฉ
- ุชูุญูุฏ ุงูุฏูุงู ูู ููุงู ูุงุญุฏ ูุณูู ุชุนุฏูููุง ูุชุทููุฑูุง ูุณุชูุจูุงู.
- ุฅุถุงูุฉ ุชุนูููุงุช ุชูุถูุญูุฉ ูุณูู ููู ุงูููุฏ.

### 4. ุชุญุณูู ุงูุฃุฏุงุก
- ุงุณุชุฎุฏุงู ุงูุฏูุงู ุงููุญุณููุฉ ูููู ูู ุงูุญุณุงุจุงุช ุบูุฑ ุงูุถุฑูุฑูุฉ.
- ุชุฌูุจ ุงูุชูุฑุงุฑ ูุญุณู ูู ุฃุฏุงุก ุงูุชุทุจูู.

## ุงูุชูุตูุงุช

### 1. ุงูุงุฎุชุจุงุฑ ุงูุดุงูู
- ููุตู ุจุฅุฌุฑุงุก ุงุฎุชุจุงุฑ ุดุงูู ููุชุฃูุฏ ูู ุนูู ุฌููุน ุงูุชุนุฏููุงุช ุจุดูู ุตุญูุญ.
- ุงูุชุฑููุฒ ุนูู ุงุฎุชุจุงุฑ:
  - ุฅุฏุฎุงู ุนุฑูุถ ุฌุฏูุฏุฉ
  - ุนูููุฉ ุงูุชูุตูุฉ
  - ุตูุญุฉ ุงูููุงุฑูุฉ
  - ุชุทุงุจู ุงููุจุงูุบ

### 2. ุงูุชูุซูู
- ููุตู ุจุชุญุฏูุซ ุงูุชูุซูู ููุนูุณ ุงูุชุบููุฑุงุช ุงูุชู ุชู ุฅุฌุฑุงุคูุง.
- ุฅุถุงูุฉ ุชุนูููุงุช ุชูุถูุญูุฉ ูุฃู ุชุนุฏููุงุช ูุณุชูุจููุฉ.

### 3. ุงูุชุทููุฑ ุงููุณุชูุจูู
- ูููู ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุฏูุงู ุงูููุญุฏุฉ ูุชุญุณูู ุงูููุฏ ุฃูุซุฑ.
- ูููู ุชุทุจูู ููุณ ุงูููุฌ ุนูู ุฃุฌุฒุงุก ุฃุฎุฑู ูู ุงูุชุทุจูู.

## ุงูุฎุงุชูุฉ

ุชู ุจูุฌุงุญ ุชูููุฐ ุฎุทูุงุช ุชูุญูุฏ ุงูุฏูุงู ุงูุญุณุงุจูุฉ ูุชุญุฏูุซ ุงููููุงุช ุงููุทููุจุฉ. ุงููุชุงุฆุฌ ุงููุญููุฉ ุชุธูุฑ ุชุญุณูุงู ูู ุฏูุฉ ุงูุญุณุงุจุงุช ูุณูููุฉ ุงูุตูุงูุฉ. ููุตู ุจุฅุฌุฑุงุก ุงุฎุชุจุงุฑ ุดุงูู ููุชุฃูุฏ ูู ุนูู ุฌููุน ุงูุชุนุฏููุงุช ุจุดูู ุตุญูุญ ูุงุณุชูุฑุงุฑูุฉ ุงูุนูููุฉ.